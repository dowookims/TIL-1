2019년 4월 7일 일요일

# 타이머의 지각과 싱글 스레드의 관계

자바스크리븥의 타이머(setTimeout, setInterval)는 지정한 시간에 콜백 함수가 실행되는 것을 보장하지 못합니다. 이 이유를 정확히 알기 위해 자바스크립트가 싱글 스레드로 동작하는 과정을 이해해야 합니다.

```javascript
function yo() {
	setTimeout(function() {
		console.log('1.5초 타이머 끝!') // 1.5초 뒤가 아닌 3초 뒤에 실행된다.
	}, 1500);

	for(let i=0; i<3; i++) {
		doSomething(); // 가정: 매번 1초가 걸리는 일
		console.log(1);
	}

	console.log('3초 걸리는 for문 끝!')
}

yo();

console.log('main 끝!');
```
* 할 일 큐
	- main 함수
	- click 핸들러
	- ...

* 콜 스택
	- 할 일 큐에서 일을 꺼내서 콜 스택으로 가져와 일을 마친 뒤, 버린다.

* Timer
	- Web API, 브라우저에서 별도로 제공하므로 밖에 있음
	- 타이머에게 function을 넘겨주고 1.5초 뒤에 실행하라고 알려준다.

먼저 for 문(1번째 doSomething()) 돌리다가
1.5초 지난 것 같으면 그 때 function을 큐에 넣는다.
그 뒤 하던 for 문 일을 마저 한다.
마저 for 문(2번째, 3번째 doSomething())을 계속 실행하고

메인 함수까지 완전히 실행 종료가 되고 스택이 비워져야,
그제서야 큐에서 function을 가져온다.

결과
```
0
1
2
3초 걸리는 for문 끝!
main 끝
1.5초 타이머 끝!
```

정리
콜 스택은 하나라 하던 일을 멈추지 못한다.
그 시간에 타이머가 큐에 함수를 넣어줄 뿐이다.
하던 일이 바쁘면 아주 한참 뒤에 콜스택이 비워져야 그 다음에 타이머에게 넣어준 함수가 실행된다.

